\ProvidesPackage{wwustyle}[%
	2018/01/07 beamer presentations using the WWU corporate design%
]
% Usage:    Just put \usepackage{wwustyle} in the header of your tex
%           file, thats all!
%           You may set the main color by using COLORCODE
%           as an option to the package, where COLORCODE is the
%           name of the color (in one word, all in small letters)
%           as defined in the corporate design manual which is
%           to be found on the web:
%           https://sso.uni-muenster.de/intern/marketing/corporatedesign/cdmanual.html
% Remark:   This is supposed to be used with the font “Meta”, which is to
%           be found on the WWU homepage and should be available
%           for employees on WWU workstations.
% Maintainers: Simon May (simon.may@uni-muenster.de)
%              Fachschaft Physik (fsphys@uni-muenster.de)

%% ========= required packages =============
\RequirePackage{tikz}
\RequirePackage{xcolor}
\RequirePackage{graphicx}
% add resource directory to search path
\graphicspath{{wwustyle/}}

% available font and background colors
% RGB color values have been taken from the WWU corporate design manual
% https://sso.uni-muenster.de/intern/marketing/corporatedesign/cdmanual.html
% the following three colors are available as backgrounds
% Pantone 312: “variant 1” of the PowerPoint template
\definecolor{pantone312} {RGB}{0,   157, 209} % light blue
% Pantone 3135: “variant 2” of the PowerPoint template
\definecolor{pantone3135}{RGB}{0,   142, 150} % green
% Pantone 7462: “variant 3” of the PowerPoint template
\definecolor{pantone7462}{RGB}{0,    78, 138} % dark blue
% the remaining colors are only available as text colors
\definecolor{pantoneblack7}{RGB}{62, 62, 59}
\definecolor{pantone315} {RGB}{0,   110, 137} % dark green/blue
\definecolor{pantone369} {RGB}{122, 181,  22} % light green
\definecolor{pantone390} {RGB}{177, 200,   0} % olive green
% the following colors are no longer part of the WWU corporate design and remain
% available only for compatibility.
\definecolor{pantone3282}{RGB}{0,   142, 150} % similar to 3135
\definecolor{pantone396} {RGB}{223, 219,   0} % pale green
\definecolor{pantoneprozessyellow}{RGB}{255, 237, 0} % yellow

% use the same text color as in the PowerPoint presentation template
% the same color is also used for the WWU logo
\definecolor{wwu-textcolor}{RGB}{88, 88, 90}
% set frame background to same color as title page background
% (“Schwarz, 5% Deckkraft”)
\definecolor{wwu-bgcolor}{RGB}{244, 244, 244}

\colorlet{prinz}{white}

% set pantone312 as the default main color
\newcommand*{\bg@maincolor}{pantone312}
\newcommand*{\fn@maincolor}{pantone312}
\newcommand*{\fn@motiv}{glocke}
\newcommand*{\wedgeskip}{0pt}

% set the main color
% for the color definitions see
% WWU corporate design manual
% https://sso.uni-muenster.de/intern/marketing/corporatedesign/cdmanual.html
% Schriftfarbe und Hintergrundfarbe muessen gesondert festgelegt
% werden, da nicht fuer alle Farben Hintergrunddateien vorliegen.
% #1: Schriftfarbe
% #2: Hintergrundfarbe (Namensteil der Hintergrunddatei)
\newcommand*{\set@wwu@maincolor}[2]{%
	\renewcommand*{\bg@maincolor}{#1}%
	\renewcommand*{\fn@maincolor}{#2}%
	\def\reserved@a{#1}%
	\def\reserved@b{#2}%
	\ifx\reserved@a\reserved@b
	\else
		\PackageWarning{wwustyle}{Background for font color #1 not available. Background color changed to #2}{}%
	\fi
}

% Take care!
% the files for the title page images are named incorrectly:
% – pantone315<…>.pdf actually uses pantone7462
% – pantone3282<…>.pdf actually uses pantone3135
% Pantone 312: “variant 1” of the PowerPoint template
\DeclareOption{pantone312}{
	\set@wwu@maincolor{pantone312}{pantone312}}
% Pantone 3135: “variant 2” of the PowerPoint template
\DeclareOption{pantone3135}{
	% background “pantone3282” is actually pantone3135
	\set@wwu@maincolor{pantone3135}{pantone3282}}
% Pantone 7462: “variant 3” of the PowerPoint template
\DeclareOption{pantone7462}{
	% background “pantone315” is actually pantone7462
	\set@wwu@maincolor{pantone7462}{pantone315}}
% the remaining colors are only available as text colors and will use one of the
% three available background colors instead
\DeclareOption{pantoneblack7}{%
	\set@wwu@maincolor{pantoneblack7}{pantone312}}
\DeclareOption{pantone315}{
	% background “pantone3282” is actually pantone3135
	\set@wwu@maincolor{pantone315}{pantone3282}}
\DeclareOption{pantone369}{%
	\set@wwu@maincolor{pantone369}{pantone312}}
\DeclareOption{pantone390}{%
	\set@wwu@maincolor{pantone390}{pantone312}}
% the following colors are no longer part of the WWU corporate design and remain
% available only for compatibility.
\DeclareOption{pantone3282}{
	\set@wwu@maincolor{pantone3282}{pantone3282}}
\DeclareOption{pantone396}{%
	\set@wwu@maincolor{pantone396}{pantone312}}
\DeclareOption{pantoneprozessyellow}{%
	\set@wwu@maincolor{pantoneprozessyellow}{pantone312}}

% Das invertierte Titelbild erscheint lediglich auf
% dem Haupttitel. Dort muss die Schrift dann
% weiß werden.
% \fn@invers dient zum Einlesen der entsprechenden Hintergrunddatei
% \bg@invers schaltet die Farbe um. 04.09.2017 gu
\newcommand*{\fn@invers}{}
\newcommand*{\bg@invers}{}
\newif\if@invers
\DeclareOption{inverse}{%
	\@inverstrue
	\renewcommand*{\fn@invers}{invers}%
	\renewcommand*{\bg@invers}{invers}%
}

% Drei Motive liegen vor:
% Glockenturm des Schlosses,
% Textkeil,
% WWU-Schriftzug auf dem Prinzipalmarkt.
\DeclareOption{belltower}{%
	\renewcommand*{\fn@motiv}{glocke}%
}
\newif\if@wedge
\@wedgefalse
\DeclareOption{wedge}{%
	\@wedgetrue
	\renewcommand*{\fn@motiv}{textkeil}%
	\renewcommand*{\wedgeskip}{35mm}%
}
\newcommand*{\p@markt}{prinzipalmarkt}
\DeclareOption{prinz}{%
	\renewcommand*{\fn@motiv}{prinzipalmarkt}%
	\@inverstrue
	\renewcommand*{\fn@invers}{invers}%
	\renewcommand*{\bg@invers}{invers}%
}

\newcommand*{\claimTextWissen}{wissen}
\newcommand*{\claimTextLeben}{leben}
\newcommand*{\claimText}{wissenleben}
\newcommand*{\claimPunktXShift}{-5.5mm}
\newcommand*{\claimPunktYShift}{-0.8mm}
\newcommand*{\claimLebenXShift}{-1.8mm}
\newcommand*{\claimWWUXShift}{-0.47mm}
\newcommand*{\claimWWUYShift}{6.4mm}
\newcommand*{\claimWWUXXShift}{1.8666mm}
\newcommand*{\claimDeEn}{}

\DeclareOption{english}{
	\renewcommand*{\claimTextWissen}{living}
	\renewcommand*{\claimTextLeben}{knowledge}
	\renewcommand*{\claimText}{livingknowledge}
	\renewcommand*{\claimPunktXShift}{-6.2mm}
	\renewcommand*{\claimPunktYShift}{-0.6mm}
	\renewcommand*{\claimLebenXShift}{0.5mm}
	\renewcommand*{\claimWWUYShift}{6.9mm}
	\renewcommand*{\claimWWUXShift}{0mm}
	\renewcommand*{\claimWWUXXShift}{2.3366mm}
	\renewcommand*{\claimDeEn}{-en}
}

% Beim Textkeil wird der gesamte Hintergrund hinterlegt,
% andernfalls bleibt der Streifen unten frei.
\newcommand*{\claimMain}{%
	\if@wedge
		\if@invers
			\claim{0.5}{white}%
		\else
			\claim{0.5}{grey}%
		\fi
	\else
		\claim{0.5}{grey}%
	\fi
}
\newcommand*{\claimTitle}{\claim{1.05}{grey}}
\newcommand*{\logoHeadline}{\wwulogo{0.3}}
\newcommand*{\logoTitle}{\wwulogo{1}}
\newcommand*{\logoTitleSmall}{\csname wwulogo\bg@invers\endcsname{0.45}}

\ProcessOptions\relax

% save the specified color as “maincolor”
\colorlet{maincolor}{\fn@maincolor}


%% ========= images and graphics ============
\newcommand*{\bgbox}[1]{\texorpdfstring{\colorbox{maincolor}{#1}}{#1}}

% WWU claim with \includegraphics; it uses two parameters:
% parameter #1: scale
% parameter #2: color
\newcommand*{\claim}[2]{%
	\strut\hskip-16mm\rlap{\includegraphics[scale=#1]{\claimText#2}}%
}

% WWU logo with \includegraphics; takes one parameter
% parameter #1: scale
\newcommand*{\wwulogo}[1]{\wwu@logo{#1}{wwu-textcolor}}
\newcommand*{\wwulogoinvers}[1]{\wwu@logo{#1}{white}}

\newcommand*{\wwu@logo}[2]{%
	\def\temp@a{#2}\def\temp@b{white}%
	\ifx\temp@a\temp@b%
	\includegraphics[scale=#1]{WWUMuenster_Logo_2017_negativ}
	\else%
	% The file WWUMuenster_Logo_2017_4c.pdf contains margins which have to
	% be cropped. There is a horizontal margin of 2.5mm and a vertical
	% margin of 2.66mm on each side. The trim option of \includegraphics
	% takes values in bp (1bp = 1/72in), so 2.5mm ≈ 7.08bp and
	% 2.66mm ≈ 7.54bp.
	\includegraphics[trim=7.08 7.54 7.08 7.54, clip, scale=#1]{WWUMuenster_Logo_2017_4c}
	\fi%
}

\newbox\bg@title
\def\hintergrundbild{\setbox\bg@title\hbox{\includegraphics[height=\paperheight]{\fn@maincolor\fn@motiv\fn@invers.pdf}}}%
\AtBeginDocument{\hintergrundbild}

% define the institute logo command
\newcommand*{\@institutelogo}{}
\newcommand*{\institutelogo}[1]{%
	\renewcommand*{\@institutelogo}{#1}
}

\newcommand*{\@institutelogosmall}{}
\newcommand*{\institutelogosmall}[1]{%
	\renewcommand*{\@institutelogosmall}{#1}
}

%% ============ margins, spacing, etc. ============
% disable left sidebar (empty)
\setbeamersize{sidebar width left=0cm}
% disable right sidebar now that the claim isn’t shown there anymore
\setbeamersize{sidebar width right=0cm}

% set text margins to 0.5cm
% this gives the same margins as before with the sidebars
% (with empty sidebars and sidebar width left=-0.25cm, sidebar width right=0.25cm)
\setbeamersize{text margin left=0.5cm}
\setbeamersize{text margin right=0.5cm}

% switch off the navigation symbols
\beamertemplatenavigationsymbolsempty

% by default give only current page number
\newcommand*{\@@insert@framenumber}{\insertframenumber}


% %% ========= possible package options ==============
% % decide, whether the page number should show up
%\DeclareOption{nopagenumbering}{%
%	\renewcommand*{\@@insert@framenumber}{}%
%}
%\DeclareOption{fullpagenumbering}{%
%	\renewcommand*{\@@insert@framenumber}{\insertframenumber\,\vrule width0.8pt height7pt depth 3pt\,\inserttotalframenumber}%
%}
% \ProcessOptions\relax


%% ============ color definitions for beamer ================
% colors to be used
\definecolor{text-grey}{rgb}{0.45, 0.45, 0.45} % grey text on white background
\definecolor{fu-blue} {RGB}{0,   51, 102} % blue text
\definecolor{fu-green}{RGB}{153, 204,  0} % green text
\definecolor{fu-red}  {RGB}{204, 0,    0} % red text (used by \alert)


%% ================= redefinition of styles ============
% colors
\usecolortheme{lily}
\setbeamercolor{normal text}{fg=wwu-textcolor, bg=wwu-bgcolor}
\setbeamercolor{alerted text}{fg=fu-red}
\setbeamercolor{example text}{fg=fu-green}
\setbeamercolor{structure}{fg=maincolor}

\setbeamercolor{block title}{fg=white, bg=maincolor}
\setbeamercolor{block title alerted}{fg=white, bg=fu-red}
\setbeamercolor{block title example}{fg=white, bg=fu-green}
\setbeamercolor{block body}{bg=maincolor!10}
\setbeamercolor{block body alerted}{bg=fu-red!10}
\setbeamercolor{block body example}{bg=fu-green!10}

\setbeamercolor{bibliography entry author}{fg=fu-blue}
\setbeamercolor{bibliography entry journal}{fg=text-grey}

% frame title
\setbeamertemplate{frametitle}{%
	\vskip4mm
	\fontsize{14pt}{14pt}
	\selectfont
	\color{maincolor}
	\bfseries
	\insertframetitle
	\par
	\ifx\insertframesubtitle\empty%
	\else
	\fontsize{12pt}{12pt}
	\selectfont
	% set frame subtitles in pantoneblack7
	% (which darker than the color of normal text)
	\color{pantoneblack7}
	\mdseries
	\insertframesubtitle
	\fi%
}

% headline
\setbeamertemplate{headline}{
	\fontsize{6pt}{1pt}
	\selectfont
	{
		\begin{tikzpicture}[remember picture, overlay]
			\node[xshift=0.54cm, yshift=-1.21cm,
			anchor=south west,
			inner sep=0] at (current page.north west) {\logoHeadline};
			\node[xshift=3.5cm, yshift=-1.21cm,
			anchor=south west,
			inner sep=0] at (current page.north west) {\@institutelogosmall};
		\end{tikzpicture}
	}
	\hfill
	\textbf{\color{maincolor}\let\bgbox\relax\insertshorttitle}%
	% same space to the right as text margin
	\hspace{0.5cm}%
	% invisible rule to set headline height
	\rule{0pt}{12mm}%
}

% title page

% Der Hintergrund für die Titelseite ist in \bg@title abgelegt.
% Diese Box wird auf der ersten Seite ausgegeben und ist
% anschließend leer.
\setbeamertemplate{background}{\hbox to \paperwidth{\hss\box\bg@title}}

% redefine \@arrayparboxrestore so that the presentation title (which is set
% using a \parbox) uses \raggedright instead of justifying text
\g@addto@macro\@arrayparboxrestore{\raggedright}

\setbeamertemplate{title page}{
	\fontsize{11pt}{1pt}
	\selectfont
	%% set the title and the author
	\setlength{\unitlength}{1mm}
	\begin{picture}(0,15)
		\put(0,8){\parbox[c]{10.75cm}{
			\fontsize{16pt}{20pt}
			\selectfont
			\edef\curr@fnt@color{maincolor}%
			\if@invers
				\edef\curr@fnt@color{white}%
			\fi
			% Beim Motiv Prinzipalmarkt auf die Farbe „prinz“ umschalten.
			\ifx\p@markt\fn@motiv
				\edef\curr@fnt@color{prinz}%
			\fi
			% Bei inversem Titelbild auf weiße Schrift umschalten.
			% Der Untertitel (s.u.) steht dann besser in halbfett.
			\color{\curr@fnt@color}
			{\bfseries
				\inserttitle
			}
			\par
			\vskip2mm
			\fontsize{8pt}{10pt}
			\selectfont
			\insertsubtitle\par
			\insertauthor
			\par
		}}
		\linespread{0.9}
		{
		\begin{tikzpicture}[remember picture, overlay]
			% Anstelle des Datums steht hier nunmehr das Institutslogo. 22.08.2017 gu
			% Ich habe es in eine \llap{} gepackt, weil nicht vorhersehbar ist,
			% was dort erscheinen soll.
			\node (datenode) [yshift=0.7cm,xshift=-1cm, inner sep=0, anchor=base] at (current page.south east)
			{\color{pantoneblack7}%
			\if@wedge
				\if@invers
					\color{white}%
				\fi
			\fi
			\llap{\fontsize{6pt}{8pt}\selectfont\@institutelogo\hskip\wedgeskip}%
			};
		\end{tikzpicture}
		}
	\end{picture}
	{
		\begin{tikzpicture}[remember picture, overlay]
			%% the claim
			\node [xshift=1.3cm, yshift=0.6cm] at (current page.south west)
				(claim) {\claimMain};
			\node [xshift=0.39cm, yshift=-1cm, anchor=west] at (current page.north west)
				{\logoTitleSmall};
		\end{tikzpicture}
	}
} %end title page

% footline
% make footline background non-transparent so that frame content cannot “slide
% into” the footer
\setbeamercolor{footlinecolor}{bg=wwu-bgcolor}
\setbeamertemplate{footline}{%
	\begin{beamercolorbox}[wd=\paperwidth]{footlinecolor}
		\fontsize{6pt}{1pt}%
		\selectfont%
		\color{maincolor}%
		\rule{\textwidth}{0.8pt}% horizontal line
		\vskip4mm%
		\hspace{5mm}%
		\textcolor{wwu-textcolor}{\let\bgbox\relax\insertshortauthor}\vrule height7pt depth3pt width0pt\hfill\textcolor{maincolor}{\fontsize{9pt}{12pt}\selectfont\textbf{\@@insert@framenumber}}\hspace{5mm}\strut%
		\vskip4mm%
	\end{beamercolorbox}%
}% end footline
